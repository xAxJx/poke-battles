<% selected_pokemons = (@selected_pokemon || []).select { |selection| selection.team_id == @team.id } %>

<section class="landing" data-landing-audio data-confirm-url="<%= asset_path('confirm.mp3') %>" data-ambient-url="<%= asset_path('Walen - Gameboy (freetouse.com).mp3') %>">
  <div class="landing-shell">
    <div class="landing-screen">
      <div class="screen-header">
        <p class="screen-title">Team Select</p>
        <div class="screen-meta">
          <span class="game-id">ID: <%= @game.id %></span>
          <button class="sound-toggle" type="button" data-sound-toggle aria-pressed="false">
            <span class="sound-icon" aria-hidden="true">ðŸ”Š</span>
            <span class="sound-label" data-sound-label>Sound Off</span>
          </button>
        </div>
      </div>

      <div class="screen-body team-select">
        <div class="team-columns">
          <div class="team-panel">
            <h2 class="panel-title">Available</h2>
            <div class="team-list">
              <% @pokemons.each do |pokemon| %>
                <div class="team-card">
                  <div class="team-sprite">
                    <% if pokemon.picture.present? %>
                      <%= image_tag pokemon.picture, alt: pokemon.name %>
                    <% end %>
                  </div>
                  <div class="team-info">
                    <p class="team-name"><%= pokemon.name.capitalize %></p>
                    <div class="team-types">
                      <% if pokemon.type1.present? %>
                        <span class="type-badge type-<%= pokemon.type1.to_s.parameterize %>"><%= pokemon.type1 %></span>
                      <% end %>
                      <% if pokemon.type2.present? %>
                        <span class="type-badge type-<%= pokemon.type2.to_s.parameterize %>"><%= pokemon.type2 %></span>
                      <% end %>
                    </div>
                  </div>
                  <div class="team-action">
                    <%= link_to "Add", new_game_team_selected_pokemon_path(@game, @team, pokemon_id: pokemon.id), class: "gb-add" %>
                  </div>
                </div>
              <% end %>
            </div>
          </div>

          <div class="team-panel">
            <h2 class="panel-title">My Team</h2>
            <% if selected_pokemons.any? %>
              <div class="team-list">
                <% selected_pokemons.each do |selection| %>
                  <% pokemon = selection.pokemon %>
                  <% next unless pokemon %>
                  <div class="team-card">
                    <div class="team-sprite">
                      <% if pokemon.picture.present? %>
                        <%= image_tag pokemon.picture, alt: pokemon.name %>
                      <% end %>
                    </div>
                    <div class="team-info">
                      <p class="team-name"><%= pokemon.name.capitalize %></p>
                      <div class="team-types">
                        <% if pokemon.type1.present? %>
                          <span class="type-badge type-<%= pokemon.type1.to_s.parameterize %>"><%= pokemon.type1 %></span>
                        <% end %>
                        <% if pokemon.type2.present? %>
                          <span class="type-badge type-<%= pokemon.type2.to_s.parameterize %>"><%= pokemon.type2 %></span>
                        <% end %>
                      </div>
                    </div>
                    <div class="team-action">
                      <%= link_to "Edit", edit_game_team_selected_pokemon_path(@game, @team, selection), class: "gb-add" %>
                    </div>
                  </div>
                <% end %>
              </div>
            <% else %>
              <p class="empty-state">No PokÃ©mon selected yet.</p>
            <% end %>
          </div>
        </div>

        <div class="team-actions">
          <%= link_to (selected_pokemons.any? ? "Confirm Team" : "Back"), new_game_battle_path, class: "start-button" %>
          <div class="secondary-actions">
            <%= link_to "PokÃ©mon List", pokemons_path, class: "menu-link" %>
            <%= link_to "Move List", moves_path, class: "menu-link" %>
            <%= link_to "Home", root_path, class: "menu-link" %>
          </div>
        </div>
      </div>
    </div>
  </div>
</section>
